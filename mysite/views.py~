from django.shortcuts import render
from mysite.forms import mailForm
from django.http import HttpResponse, HttpResponseRedirect
from django.core.mail import send_mail
# Create your views here.

def index(request):
    form = modal_check(request)
    if form is True:
        return HttpResponseRedirect('/site/')
    return render(request, 'mysite/index.html',{'form':form})

def portfolio(request):
    form = modal_check(request)
    if form is True:
        return HttpResponseRedirect('/site/')
    return render(request, 'mysite/portfolio.html',{'form':form})

def faq(request):
    form = modal_check(request)
    if form is True:
        return HttpResponseRedirect('/site/')
    return render(request, 'mysite/faq.html',{'form':form})

def modal_check(request):
    if request.method == 'POST':
        form = mailForm(request.POST)
        if form.is_valid():
            email = form.cleaned_data['email']
            print email
            send_mail('Development Test', 'Autogenerated E-mail sent by M. Faiq. Your app is working fine.', 'mfaiq1996@gmail.com',
    [email], fail_silently=False)
            print "Sent"
            form.save()
            return True;
        else:
            error = "<ul class=\"errorlist\"><li>E mail with this Email already exists.</li></ul>"
            if error == str(form.errors['email']):
                print form.data['email']
                #email =
                #print email
                #send_mail('Development Test', 'Autogenerated E-mail sent by M. Faiq. Your app is working fine.', 'mfaiq1996@gmail.com',[email], fail_silently=False)
                print "Sent"
                return True;
            else:
                pass  
    else:
        form = mailForm()
    return form
